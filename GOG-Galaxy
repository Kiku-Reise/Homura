# Created by: Alexander Vereeken <Alexander88207@protonmail.com>
# Maintainer: Alexander Vereeken <Alexander88207@protonmail.com>

if [[ $TODO == *"Installation"* ]]; then

# Download
GOGVER=2.0.23.4
download https://content-system.gog.com/open_link/download?path=/open/galaxy/client/setup_galaxy_$GOGVER.exe

# Prefix
prefix-message
echo -e "\e[40;38;5;32mSet prefix to Windows 10\e[30;48;5;82m\e[0m"
WINEPREFIX=$NDIR/Games/$INST winetricks win10

# Installer
installer-message
info "The installation will come with an error but you can ignore that."
WINEPREFIX="$NDIR/Games/$INST" wine $DDIR/setup_galaxy_$GOGVER.exe
WINEPREFIX="$NDIR/Games/$INST" winetricks sandbox
if [ -f "/usr/home/$USER/.local/share/applications/wine/Programs/GOG.com/GOG Galaxy/GOG Galaxy.desktop" ]; then
echo -e "\e[40;38;5;32mReplacing the shortcut with one that contains the required tweaks\e[30;48;5;82m\e[0m"
rm "/usr/home/$USER/.local/share/applications/wine/Programs/GOG.com/GOG Galaxy/GOG Galaxy.desktop"
echo "[Desktop Entry]
Name=GOG Galaxy
Exec=$NAME Launch '$INST'
Type=Application
StartupNotify=true
Icon=F77E_GalaxyClient.0" >> "/usr/home/$USER/.local/share/applications/wine/Programs/GOG.com/GOG Galaxy/$INST.desktop"
else 
echo -e "\e[40;38;5;32mNo shortcut was created\e[30;48;5;82m\e[0m"
fi
rm $DDIR/setup_galaxy_$GOGVER.exe
fi

if [[ $TODO == *"Launcher"* ]]; then
WINEPREFIX="$NDIR/Games/$LNCH" wine "$NDIR/Games/$LNCH/drive_c/Program Files/GOG Galaxy/GalaxyClient.exe" /runWithoutUpdating /deelevated
fi

if [[ $TODO == *"Uninstallation"* ]]; then
rm -d -r "$NDIR/Games/$UNST"
rm -d -r /usr/home/$USER/.local/share/applications/wine/Programs/GOG.com
rm -d -r "/usr/home/$USER/Desktop/GOG Galaxy.desktop"
fi

if [[ $OTR == *"Create a shortcut"* ]]; then
mkdir -p "/usr/home/$USER/.local/share/applications/wine/Programs/GOG.com/GOG Galaxy"
if [ -f "/usr/home/$USER/.local/share/applications/wine/Programs/GOG.com/GOG Galaxy/$CS.desktop" ]; then
rm "/usr/home/$USER/.local/share/applications/wine/Programs/GOG.com/GOG Galaxy/$CS.desktop"
fi
echo "[Desktop Entry]
Name="$CS"
Exec=$NAME Launch '$CS'
Type=Application
StartupNotify=true
Icon=F77E_GalaxyClient.0" >> "/usr/home/$USER/.local/share/applications/wine/Programs/GOG.com/GOG Galaxy/$CS.desktop"
fi
